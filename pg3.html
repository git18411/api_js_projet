<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-4">

    <h1 class="text-center text-primary"> Gestion de Bibliothèque</h1>

    <!-- SECTION AUTEURS -->
    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            <h3> Gestion des Auteurs</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" id="auteurNom" class="form-control mb-2" placeholder="Nom">
                    <input type="text" id="auteurNationalite" class="form-control mb-2" placeholder="Nationalité">
                    <input type="date" id="auteurNaissance" class="form-control mb-2">
                </div>
                <div class="col-md-4">
                    <input type="number" id="auteurId" class="form-control mb-2"
                        placeholder="ID pour modifier/supprimer">
                    <button class="btn btn-success w-100 mb-2" onclick="createAuteur()"> Ajouter Auteur</button>
                    <button class="btn btn-warning w-100 mb-2" onclick="updateAuteur()"> Modifier Auteur</button>
                    <button class="btn btn-danger w-100" onclick="deleteAuteur()"> Supprimer Auteur</button>
                </div>
            </div>

            <table class="table table-striped mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Nationalité</th>
                        <th>Date Naissance</th>
                    </tr>
                </thead>
                <tbody id="auteursTable">
                </tbody>
            </table>
        </div>
    </div>

    <!-- SECTION LIVRES -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white">
            <h3>Gestion des Livres</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" id="livreTitre" class="form-control mb-2" placeholder="Titre">
                    <input type="number" id="livreAuteurId" class="form-control mb-2" placeholder="ID Auteur">
                    <input type="text" id="livreGenre" class="form-control mb-2" placeholder="Genre">
                </div>
                <div class="col-md-4">
                    <input type="number" id="livreAnnee" class="form-control mb-2" placeholder="Année">
                    <input type="text" id="livreIsbn" class="form-control mb-2" placeholder="ISBN">
                    <input type="number" id="livreId" class="form-control mb-2"
                        placeholder="ID Livre pour modifier/supprimer">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info w-100 mb-2" onclick="createLivre()"> Ajouter Livre</button>
                    <button class="btn btn-warning w-100 mb-2" onclick="updateLivre()"> Modifier Livre</button>
                    <button class="btn btn-danger w-100" onclick="deleteLivre()"> Supprimer Livre</button>
                </div>
            </div>

            <table class="table table-striped mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Titre</th>
                        <th>Auteur</th>
                        <th>Genre</th>
                        <th>Année</th>
                        <th>ISBN</th>
                    </tr>
                </thead>
                <tbody id="livresTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:8000";

        // === FONCTIONS AUTEURS ===
        async function createAuteur() {
            const auteur = {
                nom: document.getElementById('auteurNom').value,
                nationalite: document.getElementById('auteurNationalite').value,
                date_naissance: document.getElementById('auteurNaissance').value
            };

            await fetch(`${API_URL}/auteurs/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(auteur)
            });
            loadAuteurs();
        }

        async function updateAuteur() {
            const id = document.getElementById('auteurId').value;
            const auteur = {
                nom: document.getElementById('auteurNom').value,
                nationalite: document.getElementById('auteurNationalite').value,
                date_naissance: document.getElementById('auteurNaissance').value
            };

            await fetch(`${API_URL}/auteurs/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(auteur)
            });
            loadAuteurs();
        }

        async function deleteAuteur() {
            const id = document.getElementById('auteurId').value;
            await fetch(`${API_URL}/auteurs/${id}`, { method: 'DELETE' });
            loadAuteurs();
        }

        async function loadAuteurs() {
            const response = await fetch(`${API_URL}/auteurs/`);
            const auteurs = await response.json();

            const tbody = document.getElementById('auteursTable');
            tbody.innerHTML = auteurs.map(auteur => `
        <tr>
            <td>${auteur.id}</td>
            <td>${auteur.nom}</td>
            <td>${auteur.nationalite}</td>
            <td>${auteur.date_naissance}</td>
        </tr>
    `).join('');
        }

        // === FONCTIONS LIVRES ===
        async function createLivre() {
            const livre = {
                titre: document.getElementById('livreTitre').value,
                auteur_id: parseInt(document.getElementById('livreAuteurId').value),
                genre: document.getElementById('livreGenre').value,
                annee_publication: parseInt(document.getElementById('livreAnnee').value),
                isbn: document.getElementById('livreIsbn').value
            };

            await fetch(`${API_URL}/livres/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(livre)
            });
            loadLivres();
        }

        async function updateLivre() {
            const id = document.getElementById('livreId').value;
            const livre = {
                titre: document.getElementById('livreTitre').value,
                auteur_id: parseInt(document.getElementById('livreAuteurId').value),
                genre: document.getElementById('livreGenre').value,
                annee_publication: parseInt(document.getElementById('livreAnnee').value),
                isbn: document.getElementById('livreIsbn').value
            };

            await fetch(`${API_URL}/livres/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(livre)
            });
            loadLivres();
        }

        async function deleteLivre() {
            const id = document.getElementById('livreId').value;
            await fetch(`${API_URL}/livres/${id}`, { method: 'DELETE' });
            loadLivres();
        }

        async function loadLivres() {
            const response = await fetch(`${API_URL}/livres/`);
            const livres = await response.json();

            const tbody = document.getElementById('livresTable');
            tbody.innerHTML = livres.map(livre => `
        <tr>
            <td>${livre.id}</td>
            <td>${livre.titre}</td>
            <td>${livre.auteur_nom}</td>
            <td>${livre.genre}</td>
            <td>${livre.annee_publication}</td>
            <td>${livre.isbn}</td>
        </tr>
    `).join('');
        }

        // Chargement initial
        loadAuteurs();
        loadLivres();
    </script>

</body>

</html>